#! /usr/bin/python3
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Closed milestone items should not be editable. Milestone items in completed
# milestones should generally be uneditable.
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# in common2, applyStates

if 'readonly' in state:
    pd[control].setReadOnly(state['isreadonly'])

# ..

states.finalized = {
    'btn_mi_new': {'enabled': False},
    'btn_mi_delete': {'enabled': False},
    'btn_mi_close': {'enabled': False},
    'btn_mi_reopen': {'enabled': False},
    'cb_mi_type': {'enabled': False},
    'cb_mi_priority': {'enabled': False},
    'cb_mi_category': {'enabled': False},
    'text_milestone_description': {'isreadonly': True},
    'txt_mi_description': {'isreadonly': True}
}

states.closed = {
    'btn_mi_new': {'enabled': False},
    'btn_mi_delete': {'enabled': False},
    'btn_mi_close': {'enabled': False},
    'btn_mi_reopen': {'enabled': True},
    'cb_mi_type': {'enabled': False},
    'cb_mi_priority': {'enabled': False},
    'cb_mi_category': {'enabled': False},
    'text_milestone_description': {'isreadonly': True},
    'txt_mi_description': {'isreadonly': True}
}

states._open = {
    'btn_mi_new': {'enabled': True},
    'btn_mi_delete': {'enabled': True},
    'btn_mi_close': {'enabled': True},
    'btn_mi_reopen': {'enabled': True},
    'cb_mi_type': {'enabled': True},
    'cb_mi_priority': {'enabled': True},
    'cb_mi_category': {'enabled': True},
    'text_milestone_description': {'isreadonly': False},
    'txt_mi_description': {'isreadonly': False}
}

# in roadmap, onSelectionChanged

smajor, sminor = dc.sp.m.selected.v
amajor, aminor = dc.sp.m.active.v

if smajor < amajor or (smajor == amajor and sminor < aminor):

    applyStates(states.finalized, dc.ui.roadmap.v)

elif smiid.status == 'Closed':

    applyStates(states.closed, dc.ui.roadmap.v)

else:
    applyStates(states._open, dc.ui.roadmap.v)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

